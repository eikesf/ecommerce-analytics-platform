version: 2
models:
  - name: fct_sales
    description: "Core fact table with one record for each product within each cart. The grain of this table is one row per product per cart"
    columns:
      - name: sales_id
        description: "Unique primary key fot the sales event, generated by concatenating cart_id and product_id"
        tests:
          - unique
          - not_null

      - name: cart_id
        description: "Identifier for the shopping cart."
        tests:
          - not_null

      - name: user_id
        description: "Foreign key to the users dimension."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_users')
                field: user_id

      - name: product_id
        description: "Foreign key to the products dimension."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_products')
                field: product_id
      
      - name: total_price
        description: "Total revenue for the item line (quantity * price)."
        tests:
           - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

  - name: fct_city_total
    description: "Aggregates sales data to calculate total revenue per city."
    columns:
      - name: city
        description: "The city where the revenue was generated."
        tests:
          - unique
          - not_null
      - name: total_revenue
        description: "The total revenue generated for the city."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
  
  - name: fct_sales_category
    description: "Aggregates sales data to calculate total revenue and units sold by product category"
    columns:
      - name: product_category
        description: "The product category."
        tests:
          - unique
          - not_null
      - name: total_revenue
        description: "The total revenue generated for the product category."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

  - name: fct_sales_per_day
    description: "Daily aggregated model summarizing key sales metrics."
    columns:
      - name: sale_date
        description: "The date on which the sales occurred."
        tests:
          - unique
          - not_null
      - name: total_revenue
        description: "The total revenue generated for the day."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
